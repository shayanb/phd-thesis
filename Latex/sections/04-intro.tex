% !TEX root = ../main.tex

% new title? The Hidden Layers of Blockchains: Technical Nuances and their Unforeseen Consequences

\chapter{Introduction} \label{sec:intro}


% = = =

\paragraph{Motivation.} In the course of my academic journey, my professional experiences have played a pivotal role in shaping and enriching my research focus. Here is a brief overview of my double life and the experiences that have led me to this dissertation: % "double life, too much??"

Starting from my role as the \texttt{Blockchain Engineer} at \textit{Bitaccess} (a Bitcoin ATM company, later \textit{NASDAQ: BTM}), I learned that Bitcoin is used by some people in a daily basis, most of whom were experiencing some level of friction with the current financial system and its limitations. It should be noted that the user base was not exclusive to the \textit{unbanked}, many others were technologists, enthusiasts or workers abroad sending remittances to their families or friends in other countries. This lead me to explore the technical nuances of different wallets, payment gateways, and key management approaches in my master’s degree~\cite{eskandari2015real}, both for the users~\cite{EBSC15} and the merchants willing to accept Bitcoin as a form of payment~\cite{eskandari2016buy}.

It was during this role that I also noticed that the public perception of cryptocurrencies as criminal money had solidified. This perception is not meritless, as there are many cases of fraud and theft in the blockchain space. Due to the \textit{pseudonymity}\footnote{Pseudonymity means even though the true identity behind the address is not known, but the address itself is an entity (in which, one might leak information about the real identity behind the entity).} and the irreversible nature of the cryptocurrency transactions, I see this technology used for a range of criminal activities, specially for (online) scams and ransomware~\cite{paquet2019ransomware,conti2018economic}. However, the blockchain technology is not inherently criminal. In fact, the technology has the potential to reduce the fraud rate by providing a transparent, global, and immutable ledger. We noticed that as a service provider, we are able to prevent some fraudulent transactions by early screening of the recipient address, and contacting the user for verification. This is only feasible due to the public nature of the blockchain and early detection of the scammers' bitcoin addresses.

Later on, my role as a \texttt{Security Engineer and Smart Contract Auditor} at \textit{ConsenSys Diligence} provided me with valuable insights into the world of smart contract security. This role was instrumental in deepening my understanding of the technical complexities and composability within the blockchain ecosystem and Decentralized Finance (DeFi). Engaging closely with the nuances of the technology and different implementations, I developed a comprehensive perspective on its operational frameworks and security paradigms. This has enabled me to identify many false technical assumptions that are not obvious to the developers and users alike~\cite{shayantokenChecklist,shayanENSaudit}. 


As the \texttt{Chief Technology Officer (CTO)} at \textit{Ether Capital (ETHC.NE)}, a publicly traded entity with the majority of holdings in cryptoassets, I was exposed to the practicalities of integrating cryptoassets into the established financial ecosystem. This experience was transformative, offering me a first-hand experience to the dialogue, strategies, and implementation processes by real-world companies as they navigate the domain of cryptoassets. It was during this time that I engaged extensively with various financial institutions and auditors, particularly in the context of annual audits and quarterly financial statements. These interactions revealed a significant disconnect between traditional auditing methods and the nuanced requirements of cryptoassets custody and ownership. I observed the overcomplicated and redundant processes that failed to address the core needs of companies and stakeholders in the realm of cryptocurrencies.

Through this thesis, I seek to shed some light on some of these knowledge gaps, and discuss the potential ethical issues and technical solutions to narrow these gaps. A few examples: In chapter~\ref{sec:cryptojacking}, we discuss the ethical questions surrounding \textit{cryptojacking} as a replacement for the online advertisements, but due to the policy vacuum it fell victim to the bad actors. In chapter~\ref{sec:frontrunning}, we discuss how some applications and solutions to ``democratize'' the profit from blockchain front-running attacks, fall in gray areas of ethics and regulations. In chapter~\ref{sec:auditing}, we discuss the challenges of auditing cryptoassets and the disconnect between the traditional auditing methods and the technical expertise required to verify a financial statement involving cryptoassets. There are many more examples throughout this thesis that I discuss the ethical and technical nuances of the blockchain technology and relevant challenges.


\section{Research Questions}
In this section, I present the research questions that I aim to address in this dissertation:

\paragraph{RQ1:} \textit{How do the inherent characteristics of blockchain technology, such as transparency, pseudonymity, and immutability, create unique (ethical) challenges?} 
This question examines the fundamental characteristics of blockchain technology and their complex implications, highlighting the trade-offs between transparency and privacy, and how immutability can enhance security while impeding the correction of misuse. Blockchain's transparency enhances trust but poses privacy risks, as seen in how transaction histories are publicly accessible, potentially exposing user activities. Pseudonymity protects user identity but complicates accountability, evident in cases of illicit activities where tracing true identities becomes challenging. Immutability ensures data integrity but prevents correction of malicious transactions, necessitating robust preventive measures. This topic is discussed in all chapters, particularly in the introduction and revisited in case studies across chapters.

\paragraph{RQ2:} \textit{What are the ethical and practical implications of using browser-based cryptojacking as an alternative to traditional online advertisements?}
This question delves into the novel use of cryptojacking for revenue generation, examining its potential as a legitimate business model and the ethical concerns it raises, such as user consent and the unintended consequences on user experience and hardware. Browser-based cryptojacking can provide a direct revenue stream without intermediaries, potentially reducing privacy invasions associated with ad tracking. However, it often operates without user consent, leading to unauthorized exploitation of computational resources and increased energy consumption. The ethicality hinges on transparency and user consent, highlighting the need for regulatory frameworks. This topic is discussed in Chapter~\ref{sec:cryptojacking}. 

\paragraph{RQ3:} \textit{How do front-running attacks exploit the decentralized nature of blockchain applications, what strategies can mitigate these attacks, and what are the (ethical) implications of these strategies?}
Addressing this question is crucial for understanding and preventing (financial) exploitation within blockchain ecosystems. It sheds light on how the transparency meant for trust and verification can be manipulated for unfair advantage. Front-running exploits the visible order of transactions, allowing malicious actors to anticipate and react to transactions for profit. Mitigation strategies include implementing privacy-enhancing technologies like confidential transactions, adjusting transaction ordering protocols to randomize or prioritize fairness, and enhancing the sophistication of detection mechanisms to flag and prevent such behaviors. Lastly, democratizing the profit from front-running attacks raises ethical concerns, as it may inadvertently incentivize malicious behavior. This topic is discussed in Chapter~\ref{sec:frontrunning}.

\paragraph{RQ4:} \textit{What role do oracles play in blockchain ecosystems, and how can their vulnerabilities be addressed to prevent manipulation?}
Oracles bridge blockchain with external data, essential for real-world smart contracts. This question explores their critical role in the trust assumptions and the security risks they introduce, emphasizing the need for reliable data feeds to ensure the integrity of decentralized applications. The critical aspect of oracles, make them targets for manipulation, which can lead to significant financial and operational risks. Ensuring oracle reliability involves decentralizing data sources, implementing robust verification mechanisms, and using cryptographic proofs to secure data feeds. In Chapter~\ref{sec:oracles}, we introduce a modular framework to evaluate oracle designs and their potential flaws based on their technical design and trust assumptions, and discuss possible mitigation strategies.

\paragraph{RQ5:} \textit{What are the challenges faced by auditing firms in verifying cryptoassets, and how can these challenges be addressed to improve the audit process?}
This question examines the complexities of auditing cryptoassets, focusing on the technical expertise required to verify blockchain transactions and the limitations of traditional auditing practices. Auditing firms face challenges in understanding blockchain technology, verifying cryptoasset ownership, and ensuring compliance with regulatory standards. Addressing these challenges involves developing specialized audit procedures, enhancing technical capabilities, and establishing industry standards for auditing cryptoassets. In Chapter~\ref{sec:auditing}, we discuss the challenges faced by auditing firms in verifying cryptoassets and propose solutions to improve the audit process.



\section{Contributions and Outline} 

In this dissertation, I discuss the technical nuances of the blockchain technology and its applications, conduct research on their unforeseen consequences that enabled bad actors to profit from unethical use of the technology. The \textit{pseudonymity}, as well as, irreversible, transparent, and permissionless aspect of the blockchain technology, enables more actors to participate in the misdeeds, which previously was only limited to a few actors (e.g. brokers in the traditional financial systems).

In ~\textbf{Chapter~\ref{sec:background}}, I offer a background and an introduction to the essential concepts necessary for comprehending this dissertation. Each chapter also includes a background section to extend the necessary concepts for the chapter.

In ~\textbf{Chapter~\ref{sec:cryptojacking}}, we present the first academic study of cryptojacking\footnote{Published in \textit{Security {\&} Privacy on the Blockchain (affiliated with Euro S{\&}P 2021)}}, covering its fast-paced growth and the ethical questions surrounding this use of the blockchain technology. \textit{In-browser Cryptojacking}~\cite{eskandari2018first} is the use of cryptocurrency mining technology to replace common online advertisement revenue mechanisms. We examine the trend towards in-browser mining of cryptocurrencies; in particular, the mining of Monero through Coinhive and similar services. This technology was introduced as a novel mean for monetizing web content, as a way to replace all the intermediaries in the typical means of advertisement and/or paywalls. In this model, a user visiting a website will seamlessly download a JavaScript code that executes in her browser, mines a cryptocurrency---typically without her consent or knowledge---and pays out the seigniorage to the website. Websites may consciously employ this as an alternative or to supplement advertisement revenue, may offer premium content in exchange for mining, or may be unwittingly serving the code as a result of a breach (in which case the seigniorage is collected by the hacker). The cryptocurrency Monero is preferred seemingly for its unfriendliness to large-scale ASIC mining that would drive browser-based efforts out of the market, as well as for its purported privacy features. We survey this landscape, conduct some measurements to establish its prevalence and profitability, outline an ethical framework for considering whether it should be classified as an attack or business opportunity, and make suggestions for the detection, mitigation and/or prevention of browser-based mining for non-consenting users.


In ~\textbf{Chapter~\ref{sec:frontrunning}}, we study the front-running attacks on blockchain applications, provide a taxonomy of these attacks, and analyze the common mitigation methods~\cite{eskandari2019sok}\footnote{Published in \textit{3rd Workshop on Trusted Smart Contracts In Association with Financial Cryptography (FC) in February 2019}, and presented at many conferences such as \textit{Ethereum DevCon V, Osaka, Japan}, and \textit{Stanford Blockchain Conference 2020}}. We consider front-running to be a course of action where an entity benefits from prior access to privileged market information about upcoming transactions and trades. Front-running has been an issue in financial instrument markets since the 1970s. With the advent of the blockchain technology, front-running has resurfaced in new forms we explore here, instigated by blockchain’s decentralized and transparent nature. Due to the public and transparent aspect of blockchains, any actor can act as the privileged actor in the information flow and abuse this early access to information to profit from it. In this chapter, we draw from a scattered body of knowledge and instances of front-running across the top 25 most active decentralized applications (DApps) deployed on Ethereum blockchain. Additionally, we carry out a detailed analysis of \textit{Status.im} initial coin offering (ICO) and show evidence of abnormal miner’s behavior indicative of front-running token purchases. Finally, we map the proposed solutions to front-running into useful categories. Lastly, we discuss the ethical and legal issues that are left unanswered so far.


In \textbf{Chapter~\ref{sec:oracles}}, we study the oracle implementations on the blockchain, and the attacks on blockchain applications that use oracles~\cite{eskandari2021sok}\footnote{Published in \textit{3rd ACM Conference on Advances in Financial Technologies}}. \textit{Oracles} are the gateways between the smart contracts and the real-world information. One fundamental limitation of blockchain-based smart contracts is that they execute in a closed environment. Thus, they only have access to data and functionality that is already on the blockchain, or is fed into the blockchain. Any interactions with the real world need to be mediated by a bridge service, which is called an \textit{oracle}. As decentralized applications mature, oracles are playing an increasingly prominent role. With their evolution comes more attacks, necessitating greater attention to their trust model. We dissect the design alternatives for oracles, showcase attacks, and discuss attack mitigation strategies.


In ~\textbf{Chapter~\ref{sec:auditing}}, we study the auditing of blockchain-based assets and the systematic challenges a company (and the auditing firms) might have to properly audit their crypto-assets~\cite{pimentel2021systemizing}\footnote{Published in \textit{American Accounting Association Journal of Information Systems (JIS 2021, Volume 35, Issue 2)} and follow up work were presented at \textit{EthDenver 2023}}. Auditing firms are hesitant to accept mandates from companies that hold a significant amount of cryptoassets, primarily because the blockchain sector introduces novel, technically sophisticated, and risky propositions that auditors are unequipped to handle. Abrupt recusals by auditors operating in this sector have led to several enterprises being placed on cease trade by securities regulators for failure to produce audited financial statements on time, thus impeding these companies from raising capital and bringing new investments to fund innovation in this space. In this chapter we critically analyze the purported roadblocks to auditing blockchain firms and map them to traditional auditing practices. We discuss four different case studies and the challenges those solutions bring forth. We urge auditors to reconsider their resistance to the blockchain sector by demonstrating that providing an audit opinion is challenging but not insurmountable.

Lastly, in ~\textbf{Chapter~\ref{sec:conclusion}}, I provide some concluding remarks and future research prospects.

\section{Additional Publications}
In this section, I present a brief summary of publications I wrote during my graduate studies that are not directly related to the main theme of this dissertation. These publications are the result of collaborations with other researchers and are not included in the main body of this dissertation.

\begin{itemize}

    \item{~\textbf{The Middleman is Dead, Long Live the Middleman: The “trust factor” and the psycho-social implications of blockchain}~\cite{gaggioli2019middleman}}\footnote{Published in \textit{Frontiers in Blockchain Journal. 2019, 2, 20}}: Blockchain is widely regarded as a breakthrough innovation that may have a profound impact on the economy and society, of a magnitude comparable to the effects of the introduction of the Internet itself. In essence, a blockchain is a decentralized peer-to-peer network with no central authority figure, which adds information to the distributed database by collectively validating the accuracy of data. Since each node of the network participates in the review and confirmation of the new information before being accepted, the need for a trustworthy intermediary is eliminated. However, as trust plays an essential role in affecting decisions when transacting with one another, it is important to understand which implications the decentralized nature of blockchain may have on individuals' sense of trust. In this contribution, we argue that the adoption of blockchain is not only a technological, but foremostly a psychological challenge, which crucially depends on the possibility of creating a trust management approach that matches the underlying distributed communication system. We first describe the decentralization technologies and possibilities they hold for the near future. Next, we discuss the psycho-social implications of the introduction of decentralized processes of trust, examining some potential scenarios, and outline a research agenda.

    \item{~\textbf{Resolving the Multiple Withdrawal Attack on ERC20 Tokens}~\cite{rahimian2019resolving}\footnote{Published in \textit{European symposium on security and privacy workshops (EuroS{\&}PW). IEEE, 2019}}}: Custom tokens are an integral component of decentralized applications (DApps) deployed on Ethereum and other blockchain platforms. For Ethereum, the ERC20 standard is a widely used token interface and is interoperable with many existing DApps, user interface platforms, and popular web applications (e.g., exchange services). An ERC20 security issue, known as the multiple withdrawal attack, was raised on GitHub and has been open since October 2017. The issue concerns ERC20's defined method approve() which was envisioned as a way for token holders to give permission for other users and DApps to withdraw a capped number of tokens. The security issue arises when a token holder wants to adjust the amount of approved tokens from N to M (this could be an increase or decrease). If malicious, a user or DApp who is approved for N tokens can front-run the adjustment transaction to first withdraw N tokens, then allow the approval to be confirmed, and withdraw an additional M tokens. In this paper, we evaluate 10 proposed mitigations for these issues and find that no solution is fully satisfactory. We then propose 2 new solutions that mitigate the attack, one of which fully fulfills constraints of the standard, and the second one shows a general limitation in addressing this issue from ERC20’s approve method.


    \item{~\textbf{On the feasibility of decentralized derivatives markets}~\cite{eskandari2017feasibility}\footnote{Published in \textit{Financial Cryptography and Data Security: FC 2017 WTSC}}}: In this paper, we present Velocity, a decentralized market deployed on Ethereum for trading a custom type of derivative option. To enable the smart contract to work, we also implement a price fetching tool called PriceGeth. We present this as a case study, noting challenges in development of the system that might be of independent interest to whose working on smart contract implementations. We also apply recent academic results on the security of the Solidity smart contract language in validating our code’s security. Finally, we discuss more generally the use of smart contracts in modelling financial derivatives.

    \item{~\textbf{Buy your coffee with bitcoin: Real-world deployment of a bitcoin point of sale terminal}~\cite{eskandari2016buy}\footnote{Published in \textit{2016 Intl IEEE Conferences on Advanced and Trusted Computing}}}: In this paper we discuss existing approaches for Bitcoin payments, as suitable for a small business for small-value transactions. We develop an evaluation framework utilizing security, usability, deployability criteria, examine several existing systems, tools. Following a requirements engineering approach, we designed, implemented a new Point of Sale (PoS) system that satisfies an optimal set of criteria within our evaluation framework. Our open source system, Aunja PoS, has been deployed in a real world café since October 2014.

    \item{~\textbf{A first look at the usability of bitcoin key management}\footnote{Published in \textit{NDSS Workshop on Usable Security (USEC) 2015}}}: Bitcoin users are directly or indirectly forced to deal with public key cryptography, which has a number of security and usability challenges that differ from the password-based authentication underlying most online banking services. Users must ensure that keys are simultaneously accessible, resistant to digital theft and resilient to loss. In this paper, we contribute an evaluation framework for comparing Bitcoin key management approaches, and conduct a broad usability evaluation of six representative Bitcoin clients. We find that Bitcoin shares many of the fundamental challenges of key management known from other domains, but that Bitcoin may present a unique opportunity to rethink key management for end users.

\end{itemize}

